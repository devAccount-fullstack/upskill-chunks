<section class="testimonial-gallery-section">
  <div class="content-container">
    {% if section.settings.section_title != blank %}
      <h2 class="testimonial-section-title">{{ section.settings.section_title }}</h2>
    {% endif %}

    <div class="gallery-row">
      {% for block in section.blocks %}
        {% if block.type == 'testimonial_item' %}
          <div class="gallery-item gallery-item--testimonial" {{ block.shopify_attributes }}>
            {% if block.settings.background_image %}
              <div class="gallery-item__image">
                {{
                  block.settings.background_image
                  | image_url: width: 800
                  | image_tag: loading: 'lazy', alt: 'Customer testimonial'
                }}
              </div>
            {% endif %}

            <div class="testimonial-content">
              <div class="testimonial-header">
                {% if block.settings.customer_name != blank %}
                  <h3 class="customer-name">{{ block.settings.customer_name }}</h3>
                {% endif %}
              </div>

              {% if block.settings.testimonial_text != blank %}
                <p class="testimonial-text">{{ block.settings.testimonial_text }}</p>
              {% endif %}
            </div>

            <div class="testimonial-wave">
              <svg height="13" viewBox="0 0 592 13" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M-64 3.14808C-59.2 -0.544153 -54.4 -0.544153 -49.6 3.14808C-44.8 6.84032 -40 6.84032 -35.2 3.14809C-30.4 -0.544144 -25.6 -0.544144 -20.8 3.14809C-16 6.84032 -11.2 6.84032 -6.4 3.1481C-1.6 -0.544137 3.2 -0.544137 8 3.1481C12.8 6.84032 17.6 6.84032 22.4 3.1481C27.2 -0.544137 32 -0.544128 36.8 3.14811C41.6 6.84032 46.4 6.84032 51.2 3.14811C56 -0.544128 60.8 -0.544121 65.6 3.14812C70.4 6.84032 75.2 6.84032 80 3.14812C84.8 -0.544121 89.6 -0.54412 94.4 3.14812C99.2 6.84032 104 6.84032 108.8 3.14812C113.6 -0.544112 118.4 -0.544112 123.2 3.14812C128 6.8404 132.8 6.8404 137.6 3.14813C142.4 -0.544105 147.2 -0.544105 152 3.14813C156.8 6.8404 161.6 6.8404 166.4 3.14813C171.2 -0.544097 176 -0.544096 180.8 3.14814C185.6 6.8404 190.4 6.8404 195.2 3.14814C200 -0.544088 204.8 -0.544089 209.6 3.14815C214.4 6.8404 219.2 6.8404 224 3.14815C228.8 -0.544089 233.6 -0.544088 238.4 3.14816C243.2 6.8404 248 6.8404 252.8 3.14816C257.6 -0.54408 262.4 -0.54408 267.2 3.14816C272 6.8404 276.8 6.8404 281.6 3.14816C286.4 -0.544073 291.2 -0.544073 296 3.14816C300.8 6.8404 305.6 6.8404 310.4 3.14817C315.2 -0.544064 320 -0.544064 324.8 3.14817C329.6 6.8404 334.4 6.8404 339.2 3.14818C344 -0.544057 348.8 -0.544057 353.6 3.14818C358.4 6.8404 363.2 6.8404 368 3.14818C372.8 -0.544057 377.6 -0.544057 382.4 3.14819C387.2 6.8404 392 6.8404 396.8 3.14819C401.6 -0.544049 406.4 -0.544048 411.2 3.1482C416 6.8404 420.8 6.8404 425.6 3.1482C430.4 -0.544041 435.2 -0.544041 440 3.1482C444.8 6.8404 449.6 6.8404 454.4 3.1482C459.2 -0.544033 464 -0.544033 468.8 3.1482C473.6 6.84048 478.4 6.84048 483.2 3.14821C488 -0.544025 492.8 -0.544025 497.6 3.14821C502.4 6.84048 507.2 6.84048 512 3.14821C516.8 -0.544025 521.6 -0.544017 526.4 3.14822C531.2 6.84048 536 6.84048 540.8 3.14822C545.6 -0.544017 550.4 -0.544009 555.2 3.14823C560 6.84048 564.8 6.84048 569.6 3.14823C574.4 -0.544009 579.2 -0.544009 584 3.14824C588.8 6.84048 593.6 6.84048 598.4 3.14824C603.2 -0.544001 608 -0.544001 612.8 3.14824C617.6 6.84048 622.4 6.84048 627.2 3.14824C632 -0.543993 636.8 -0.543993 641.6 3.14824C646.4 6.84048 651.2 6.84048 656 3.14825V12.3789H-64V3.14808Z" fill="#FEF3F3"/>
              </svg>
            </div>
          </div>
        {% endif %}

        {% if block.type == 'video_item' %}
          <div class="gallery-item gallery-item--video" {{ block.shopify_attributes }}>
            {% if block.settings.video_image %}
              <div class="gallery-item__image">
                {{
                  block.settings.video_image
                  | image_url: width: 600
                  | image_tag: loading: 'lazy', alt: 'Video thumbnail'
                }}
              </div>
            {% endif %}

            {% if block.settings.video_url == blank %}
              <a href="{{ block.settings.video_url }}" class="video-play-button" target="_blank">
                <div class="play-icon-bg"></div>
                <svg
                  width="127"
                  height="127"
                  viewBox="0 0 127 127"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  style="position: absolute; z-index: 0;"
                >
                  <path d="M57.5864 2.99066C60.7596 -0.49218 66.2404 -0.492182 69.4136 2.99065L73.9186 7.93523C76.0236 10.2456 79.2814 11.1186 82.2596 10.1702L88.6333 8.14056C93.1228 6.71094 97.8694 9.45135 98.876 14.0542L100.305 20.5888C100.973 23.6422 103.358 26.0271 106.411 26.6948L112.946 28.124C117.549 29.1306 120.289 33.8772 118.859 38.3667L116.83 44.7404C115.881 47.7186 116.754 50.9764 119.065 53.0814L124.009 57.5864C127.492 60.7596 127.492 66.2404 124.009 69.4136L119.065 73.9186C116.754 76.0236 115.881 79.2814 116.83 82.2596L118.859 88.6333C120.289 93.1228 117.549 97.8694 112.946 98.876L106.411 100.305C103.358 100.973 100.973 103.358 100.305 106.411L98.876 112.946C97.8694 117.549 93.1228 120.289 88.6333 118.859L82.2596 116.83C79.2814 115.881 76.0236 116.754 73.9186 119.065L69.4136 124.009C66.2404 127.492 60.7596 127.492 57.5864 124.009L53.0814 119.065C50.9764 116.754 47.7186 115.881 44.7404 116.83L38.3667 118.859C33.8772 120.289 29.1306 117.549 28.124 112.946L26.6948 106.411C26.0271 103.358 23.6422 100.973 20.5888 100.305L14.0542 98.876C9.45135 97.8694 6.71094 93.1228 8.14056 88.6333L10.1702 82.2596C11.1186 79.2814 10.2457 76.0236 7.93523 73.9186L2.99065 69.4136C-0.492181 66.2404 -0.492182 60.7596 2.99065 57.5864L7.93522 53.0814C10.2456 50.9764 11.1186 47.7186 10.1702 44.7404L8.14056 38.3667C6.71094 33.8772 9.45135 29.1306 14.0542 28.124L20.5888 26.6948C23.6422 26.0271 26.0271 23.6422 26.6948 20.5888L28.124 14.0542C29.1306 9.45135 33.8772 6.71094 38.3667 8.14056L44.7404 10.1702C47.7186 11.1186 50.9764 10.2457 53.0814 7.93523L57.5864 2.99066Z" fill="{{ section.settings.content_bg_color }}"/>
                </svg>
                <span class="play-text">
                  <span>Play</span>
                  <span>video</span>
                </span>
              </a>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="gallery-navigation">
      <button class="nav-btn nav-btn--prev">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
      <button class="nav-btn nav-btn--next">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
          <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="story-wave">
    <svg height="48" viewBox="0 0 1440 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M-444 5.53835C-423.06 -1.84612 -402.12 -1.84612 -381.18 5.53835C-360.24 12.9228 -339.3 12.9228 -318.36 5.53837C-297.42 -1.8461 -276.48 -1.8461 -255.54 5.53837C-234.6 12.9228 -213.66 12.9228 -192.72 5.53839C-171.78 -1.84609 -150.84 -1.84609 -129.9 5.53839C-108.96 12.9228 -88.02 12.9228 -67.08 5.53839C-46.14 -1.84609 -25.2 -1.84607 -4.25998 5.5384C16.68 12.9228 37.62 12.9228 58.56 5.5384C79.5 -1.84607 100.44 -1.84605 121.38 5.53842C142.32 12.9228 163.26 12.9228 184.2 5.53842C205.14 -1.84605 226.08 -1.84605 247.02 5.53843C267.96 12.9228 288.9 12.9228 309.84 5.53843C330.78 -1.84604 351.72 -1.84604 372.66 5.53843C393.6 12.923 414.54 12.923 435.48 5.53845C456.42 -1.84602 477.36 -1.84602 498.3 5.53845C519.24 12.923 540.18 12.923 561.12 5.53845C582.06 -1.84601 603 -1.84601 623.94 5.53847C644.88 12.923 665.82 12.923 686.76 5.53847C707.7 -1.84599 728.64 -1.84599 749.58 5.53848C770.52 12.923 791.46 12.923 812.4 5.53848C833.34 -1.84599 854.28 -1.84599 875.22 5.5385C896.16 12.923 917.1 12.923 938.04 5.5385C958.98 -1.84597 979.92 -1.84597 1000.86 5.5385C1021.8 12.923 1042.74 12.923 1063.68 5.53851C1084.62 -1.84596 1105.56 -1.84596 1126.5 5.53851C1147.44 12.923 1168.38 12.923 1189.32 5.53853C1210.26 -1.84594 1231.2 -1.84594 1252.14 5.53853C1273.08 12.923 1294.02 12.923 1314.96 5.53855C1335.9 -1.84593 1356.84 -1.84593 1377.78 5.53855C1398.72 12.923 1419.66 12.923 1440.6 5.53855C1461.54 -1.84593 1482.48 -1.84593 1503.42 5.53856C1524.36 12.923 1545.3 12.923 1566.24 5.53856C1587.18 -1.84591 1608.12 -1.84591 1629.06 5.53858C1650 12.923 1670.94 12.923 1691.88 5.53858C1712.82 -1.84589 1733.76 -1.84589 1754.7 5.53858C1775.64 12.923 1796.58 12.923 1817.52 5.53859C1838.46 -1.84588 1859.4 -1.84588 1880.34 5.53859C1901.28 12.9231 1922.22 12.9231 1943.16 5.53861C1964.1 -1.84586 1985.04 -1.84586 2005.98 5.53861C2026.92 12.9231 2047.86 12.9231 2068.8 5.53861C2089.74 -1.84586 2110.68 -1.84585 2131.62 5.53863C2152.56 12.9231 2173.5 12.9231 2194.44 5.53863C2215.38 -1.84585 2236.32 -1.84583 2257.26 5.53864C2278.2 12.9231 2299.14 12.9231 2320.08 5.53864C2341.02 -1.84583 2361.96 -1.84583 2382.9 5.53866C2403.84 12.9231 2424.78 12.9231 2445.72 5.53866C2466.66 -1.84581 2487.6 -1.84581 2508.54 5.53866C2529.48 12.9231 2550.42 12.9231 2571.36 5.53867C2592.3 -1.8458 2613.24 -1.8458 2634.18 5.53867C2655.12 12.9231 2676.06 12.9231 2697 5.53869V24H-444V5.53835Z" fill="#FFB1BB"/>
    </svg>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const galleryRow = document.querySelector('.gallery-row');
    const prevBtn = document.querySelector('.nav-btn--prev');
    const nextBtn = document.querySelector('.nav-btn--next');
    const galleryItems = document.querySelectorAll('.gallery-item');
    const container = document.querySelector('.content-container');

    if (!galleryRow || !prevBtn || !nextBtn || galleryItems.length === 0) return;

    let currentIndex = 0;
    const maxIndex = galleryItems.length - 1;

    function updateSlider() {
      const containerWidth = container.offsetWidth;
      const currentItem = galleryItems[currentIndex];
      const itemWidth = currentItem.offsetWidth;

      let scrollAmount = 0;
      for (let i = 0; i < currentIndex; i++) {
        scrollAmount += galleryItems[i].offsetWidth + 16;
      }

      const centerOffset = (containerWidth - itemWidth) / 2;
      const finalPosition = scrollAmount - centerOffset;

      galleryRow.style.transform = `translateX(-${Math.max(0, finalPosition)}px)`;

      prevBtn.style.opacity = currentIndex === 0 ? '0.5' : '1';
      nextBtn.style.opacity = currentIndex === maxIndex ? '0.5' : '1';
      prevBtn.disabled = currentIndex === 0;
      nextBtn.disabled = currentIndex === maxIndex;
    }

    prevBtn.addEventListener('click', function () {
      if (currentIndex > 0) {
        currentIndex--;
        updateSlider();
      }
    });

    nextBtn.addEventListener('click', function () {
      if (currentIndex < maxIndex) {
        currentIndex++;
        updateSlider();
      }
    });

    updateSlider();
    window.addEventListener('resize', updateSlider);
  });
</script>

{% style %}
  .testimonial-gallery-section {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 128px 24px 96px;
    background: linear-gradient(180deg, {{ section.settings.bg_gradient_start }} 0%, {{ section.settings.bg_gradient_end }} 100%);
    overflow: hidden;
  }

  .content-container {
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 48px;
  }

  .testimonial-section-title {
    font-family: 'True North Black', 'Arial Black', Impact, sans-serif;
    font-weight: 400;
    font-size: 48px;
    line-height: 90%;
    text-align: center;
    letter-spacing: -0.04em;
    text-transform: uppercase;
    color: {{ section.settings.title_color }};
    margin: 0;
    max-width: 846px;
  }

  .gallery-row {
    display: flex;
    gap: 16px;
    width: 100%;
    height: 511px;
    transition: transform 0.4s ease;
  }

  .gallery-item {
    position: relative;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0px 8px 20px rgba(75, 10, 6, 0.1);
    background: #FFFFFF;
    flex-shrink: 0;
  }

  .gallery-item--testimonial {
    width: 592px;
    background: {{ section.settings.testimonial_bg_color }};
  }

  .gallery-item--testimonial .gallery-item__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }

  .gallery-item--testimonial .gallery-item__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: 0% 73%;
  }

  .gallery-item--video {
    width: 288px;
    opacity: 0.5;
    transition: opacity 0.3s ease;
  }

  .gallery-item--video:hover {
    opacity: 1;
  }

  .gallery-item__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 518px;
    height: 518px;
    left: calc(50% - 518px/2);
    top: calc(50% - 518px/2 + 0.38px);
    overflow: hidden;
  }

  .gallery-item__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .testimonial-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: {{ section.settings.content_bg_color }};
    padding: 16px 24px 24px;
    z-index: 2;
  }

  .customer-name {
    font-family: 'Open Sauce Sans', sans-serif;
    font-weight: 700;
    font-size: 20px;
    line-height: 22px;
    color: {{ section.settings.text_color }};
    margin: 0 0 12px 0;
  }

  .testimonial-text {
    font-family: 'Open Sauce Sans', sans-serif;
    font-weight: 600;
    font-size: 16px;
    line-height: 150%;
    color: {{ section.settings.text_color }};
    margin: 0;
  }

  .testimonial-wave {
    position: absolute;
    bottom: 148px;
    width: 720px;
    height: 15px;
    z-index: 1;
  }

  .video-play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    z-index: 2;
    opacity: 0;
    transition: opacity 0.3s ease;
    width: 113px;
    height: 60px;
    border-radius: 200px;
  }

  .gallery-item--video:hover .video-play-button {
    opacity: 1;
  }

  .play-icon-bg {
    position: absolute;
    width: 134px;
    height: 134px;
    left: calc(50% - 134px/2 + 0.5px);
    top: calc(50% - 134px/2);
    background: {{ section.settings.content_bg_color }};
    border-radius: 8px;
    z-index: 0;
  }

  .play-text {
    font-family: 'True North Black', 'Arial Black', Impact, sans-serif;
    font-weight: 400;
    font-size: 16px;
    line-height: 100%;
    text-transform: uppercase;
    color: {{ section.settings.text_color }};
    z-index: 1;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .gallery-navigation {
    display: flex;
    gap: 16px;
  }

  .nav-btn {
    width: 52px;
    height: 52px;
    border-radius: 50px;
    border: 1px solid {{ section.settings.text_color }};
    background: transparent;
    color: {{ section.settings.text_color }};
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
  }

  .nav-btn:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  .nav-btn:hover {
    background: {{ section.settings.text_color }};
    color: {{ section.settings.content_bg_color }};
  }

  .story-wave {
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    height: 32px;
    z-index: 3;
  }

  .story-wave svg {
    display: block;
    width: 100%;
    height: 100%;
    min-width: 1440px;
  }

  @media screen and (max-width: 1024px) {
    .testimonial-section-title {
      font-size: 36px;
    }

    .gallery-row {
      height: 400px;
    }

    .gallery-item--testimonial {
      width: 480px;
    }

    .gallery-item--video {
      width: 240px;
    }

    .gallery-item__image {
      width: 420px;
      height: 420px;
      left: calc(50% - 420px/2);
      top: calc(50% - 420px/2);
    }

    .testimonial-wave {
      bottom: 120px;
      width: 600px;
    }

    .customer-name {
      font-size: 18px;
    }

    .testimonial-text {
      font-size: 14px;
    }
  }

  @media screen and (max-width: 768px) {
    .testimonial-gallery-section {
      padding: 48px 16px 36px;
    }

    .content-container {
      gap: 32px;
    }

    .testimonial-section-title {
      font-size: 24px;
      max-width: 100%;
    }

    .gallery-row {
      height: 320px;
      gap: 12px;
    }

    .gallery-item {
      border-radius: 8px;
    }

    .gallery-item--testimonial {
      width: 380px;
    }

    .gallery-item--video {
      width: 180px;
      opacity: 1;
    }

    .gallery-item__image {
      width: 320px;
      height: 320px;
      left: calc(50% - 320px/2);
      top: calc(50% - 320px/2);
    }

    .testimonial-content {
      padding: 12px 16px 16px;
    }

    .customer-name {
      font-size: 16px;
      line-height: 18px;
      margin: 0 0 8px 0;
    }

    .testimonial-text {
      font-size: 13px;
      line-height: 140%;
    }

    .testimonial-wave {
      bottom: 95px;
      width: 480px;
      height: 12px;
    }

    .video-play-button {
      opacity: 1;
      width: 90px;
      height: 48px;
    }

    .play-icon-bg {
      width: 100px;
      height: 100px;
      left: calc(50% - 100px/2);
      top: calc(50% - 100px/2);
    }

    .play-text {
      font-size: 13px;
    }

    .video-play-button svg {
      width: 100px;
      height: 100px;
    }

    .gallery-navigation {
      gap: 12px;
    }

    .nav-btn {
      width: 44px;
      height: 44px;
    }

    .nav-btn svg {
      width: 20px;
      height: 20px;
    }

    .story-wave {
      height: 24px;
    }
  }

  @media screen and (max-width: 480px) {
    .testimonial-section-title {
      font-size: 20px;
    }

    .gallery-row {
      height: 280px;
    }

    .gallery-item--testimonial {
      width: 320px;
    }

    .gallery-item--video {
      width: 160px;
    }

    .gallery-item__image {
      width: 280px;
      height: 280px;
      left: calc(50% - 280px/2);
      top: calc(50% - 280px/2);
    }

    .customer-name {
      font-size: 14px;
    }

    .testimonial-text {
      font-size: 12px;
    }

    .testimonial-wave {
      bottom: 80px;
      width: 400px;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Testimonial Gallery",
  "tag": "section",
  "class": "section-testimonial-gallery",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Time to stop missing out. Join the Sweet & Salty Society."
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_gradient_start",
      "label": "Background Gradient Start",
      "default": "#FEF3F3"
    },
    {
      "type": "color",
      "id": "bg_gradient_end",
      "label": "Background Gradient End",
      "default": "#FED2D7"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title Color",
      "default": "#9B3462"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#9B3462"
    },
    {
      "type": "color",
      "id": "testimonial_bg_color",
      "label": "Testimonial Background Color",
      "default": "#FDE8E6"
    },
    {
      "type": "color",
      "id": "content_bg_color",
      "label": "Content Background Color",
      "default": "#FEF3F3"
    }
  ],
  "blocks": [
    {
      "type": "testimonial_item",
      "name": "Testimonial",
      "limit": 1,
      "settings": [
        {
          "type": "image_picker",
          "id": "background_image",
          "label": "Background Image"
        },
        {
          "type": "text",
          "id": "customer_name",
          "label": "Customer Name",
          "default": "Gendron C."
        },
        {
          "type": "textarea",
          "id": "testimonial_text",
          "label": "Testimonial Text",
          "default": "Love all the products y'all sell. Has the best taste of all that I have ever had. You have my business for ever!!! I haven't even eaten all that I have, but this was a deal I couldn't pass 😋"
        }
      ]
    },
    {
      "type": "video_item",
      "name": "Video Item",
      "settings": [
        {
          "type": "image_picker",
          "id": "video_image",
          "label": "Video Thumbnail"
        },
        {
          "type": "url",
          "id": "video_url",
          "label": "Video URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Testimonial Gallery",
      "blocks": [
        {
          "type": "testimonial_item"
        },
        {
          "type": "video_item"
        },
        {
          "type": "video_item"
        },
        {
          "type": "video_item"
        },
        {
          "type": "video_item"
        }
      ]
    }
  ]
}
{% endschema %}
