<section class="ingredients-section">
  <div class="ingredients-container">
    {% if section.settings.section_title != blank %}
      <h2 class="ingredients-title">{{ section.settings.section_title }}</h2>
    {% endif %}

    <div class="ingredients-content">
      <div class="ingredients-nav">
        {% for block in section.blocks %}
          {% if block.type == 'product' %}
            <button
              class="ingredient-nav-item {% if forloop.first %}active{% endif %}"
              data-product="{{ block.id }}"
              {{ block.shopify_attributes }}
            >
              <span class="ingredient-nav-circle">
                {% if block.settings.product_icon %}
                  {{
                    block.settings.product_icon
                    | image_url: width: 100
                    | image_tag: class: 'ingredient-icon', alt: block.settings.product_name
                  }}
                {% endif %}
              </span>
            </button>
          {% endif %}
        {% endfor %}
      </div>

      <div class="products-wrapper">
        {% for block in section.blocks %}
          {% if block.type == 'product' %}
            <div class="product-content {% if forloop.first %}active{% endif %}" data-product-content="{{ block.id }}">
              <div class="ingredients-grid">
                {% assign ingredient_index = 0 %}
                {% for ingredient_block in section.blocks %}
                  {% if ingredient_block.type == 'ingredient'
                    and ingredient_block.settings.parent_product == block.id
                  %}
                    {% assign ingredient_index = ingredient_index | plus: 1 %}
                    {% assign is_left = ingredient_index | modulo: 2 %}

                    <div
                      class="ingredient-item {% if is_left == 1 %}ingredient-item--left{% else %}ingredient-item--right{% endif %}"
                      {{ ingredient_block.shopify_attributes }}
                    >
                      <div class="ingredient-icon-wrapper">
                        {% if ingredient_block.settings.ingredient_image %}
                          {{
                            ingredient_block.settings.ingredient_image
                            | image_url: width: 100
                            | image_tag: class: 'ingredient-image', alt: ingredient_block.settings.ingredient_name
                          }}
                        {% else %}
                          <span class="ingredient-placeholder">ðŸŒ¾</span>
                        {% endif %}
                      </div>

                      <h3 class="ingredient-name">{{ ingredient_block.settings.ingredient_name }}</h3>
                    </div>
                  {% endif %}
                {% endfor %}
              </div>

              {% if block.settings.center_image %}
                <div class="ingredients-center-image">
                  {{
                    block.settings.center_image
                    | image_url: width: 600
                    | image_tag: loading: 'lazy', alt: block.settings.product_name
                  }}
                </div>
              {% endif %}

              <div class="ingredients-flavor">
                <h3 class="flavor-name">{{ block.settings.flavor_name | default: block.settings.product_name }}</h3>
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <div class="ingredients-wave ingredients-wave--top"></div>
  <div class="ingredients-wave ingredients-wave--bottom"></div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const navItems = document.querySelectorAll('.ingredient-nav-item');
    const productContents = document.querySelectorAll('.product-content');

    navItems.forEach((nav) => {
      nav.addEventListener('click', function () {
        const productId = this.getAttribute('data-product');

        navItems.forEach((n) => n.classList.remove('active'));
        productContents.forEach((p) => p.classList.remove('active'));

        this.classList.add('active');
        document.querySelector(`[data-product-content="${productId}"]`).classList.add('active');
      });
    });
  });
</script>

{% style %}
  .ingredients-section {
    position: relative;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 96px 24px 128px;
    gap: 32px;
    width: 100%;
    background: {{ section.settings.bg_color }};
    isolation: isolate;
  }

  .ingredients-container {
    max-width: {{ section.settings.container_width }}px;
    margin: 0 auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 64px;
  }

  .ingredients-title {
    font-family: 'True North Black', 'Arial Black', Impact, sans-serif;
    font-weight: 400;
    font-size: 48px;
    line-height: 90%;
    text-align: center;
    letter-spacing: -0.04em;
    text-transform: uppercase;
    color: {{ section.settings.title_color }};
    margin: 0;
    max-width: 502px;
  }

  .ingredients-content {
    position: relative;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 64px;
  }

  .ingredients-nav {
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 12px;
    flex-wrap: wrap;
  }

  .ingredient-nav-item {
    box-sizing: border-box;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 5px;
    width: 82px;
    height: 82px;
    border: 2px solid transparent;
    border-radius: 100px;
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .ingredient-nav-item.active {
    border-color: {{ section.settings.title_color }};
  }

  .ingredient-nav-item:hover {
    border-color: {{ section.settings.title_color }};
    transform: scale(1.05);
  }

  .ingredient-nav-circle {
    width: 72px;
    height: 72px;
    border-radius: 100px;
    background: linear-gradient(314.58deg, #FDE8E6 0.36%, #FEF3F3 99.64%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
  }

  .ingredient-icon {
    width: 85%;
    height: 85%;
    object-fit: contain;
  }

  .products-wrapper {
    position: relative;
    width: 100%;
    min-height: 700px;
  }

  .product-content {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s ease, visibility 0.5s ease;
    display: flex;
    flex-direction: column;
    gap: 96px;
  }

  .product-content.active {
    opacity: 1;
    visibility: visible;
    position: relative;
  }

  .ingredients-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 64px 16px;
    padding: 0 64px;
    position: relative;
  }

  .ingredient-item {
    display: flex;
    flex-direction: column;
    gap: 16px;
    padding: 16px 16px 24px;
    border-bottom: 1px dashed {{ section.settings.title_color }};
  }

  .ingredient-item--left {
    align-items: flex-start;
    text-align: left;
  }

  .ingredient-item--right {
    align-items: flex-end;
    text-align: right;
  }

  .ingredient-icon-wrapper {
    width: 72px;
    height: 72px;
    background: #FEF3F3;
    border: 1px solid #FCDCDA;
    border-radius: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .ingredient-image {
    width: 80%;
    height: 80%;
    object-fit: contain;
  }

  .ingredient-placeholder {
    font-size: 32px;
  }

  .ingredient-name {
    font-family: 'True North Black', 'Arial Black', Impact, sans-serif;
    font-weight: 400;
    font-size: 24px;
    line-height: 100%;
    letter-spacing: -0.04em;
    text-transform: uppercase;
    color: {{ section.settings.title_color }};
    margin: 0;
  }

  .ingredients-center-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 584px;
    height: 512px;
    pointer-events: none;
    z-index: 2;
  }

  .ingredients-center-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }

  .ingredients-flavor {
    text-align: center;
  }

  .flavor-name {
    font-family: 'True North Black', 'Arial Black', Impact, sans-serif;
    font-weight: 400;
    font-size: 56px;
    line-height: 90%;
    letter-spacing: -0.04em;
    text-transform: uppercase;
    color: {{ section.settings.title_color }};
    margin: 0;
  }

  .ingredients-wave {
    position: absolute;
    left: 0;
    width: 100%;
    height: 24px;
    background: {{ section.settings.wave_color }};
    z-index: 1;
  }

  .ingredients-wave--top {
    top: 0;
    transform: scaleY(-1);
  }

  .ingredients-wave--bottom {
    bottom: 0;
  }

  @media screen and (max-width: 1024px) {
    .ingredients-title {
      font-size: 40px;
    }

    .ingredients-grid {
      padding: 0 32px;
    }

    .ingredients-center-image {
      width: 400px;
      height: 350px;
    }

    .flavor-name {
      font-size: 42px;
    }
  }

  @media screen and (max-width: 768px) {
    .ingredients-section {
      padding: 64px 16px 80px;
    }

    .ingredients-title {
      font-size: 32px;
    }

    .ingredients-grid {
      grid-template-columns: 1fr;
      padding: 0 16px;
    }

    .ingredient-item--right {
      align-items: flex-start;
      text-align: left;
    }

    .ingredients-center-image {
      position: relative;
      width: 100%;
      max-width: 300px;
      height: 300px;
      top: auto;
      left: auto;
      transform: none;
      margin: 32px auto;
    }

    .products-wrapper {
      min-height: auto;
    }

    .flavor-name {
      font-size: 32px;
    }

    .ingredients-nav {
      gap: 8px;
    }

    .ingredient-nav-item {
      width: 60px;
      height: 60px;
    }

    .ingredient-nav-circle {
      width: 50px;
      height: 50px;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Ingredients Showcase",
  "tag": "section",
  "class": "section-ingredients",
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "section_title",
      "label": "Section Title",
      "default": "Simple and recognizable ingredients"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "container_width",
      "min": 1000,
      "max": 1440,
      "step": 20,
      "unit": "px",
      "label": "Container Width",
      "default": 1400
    },
    {
      "type": "header",
      "content": "Colors"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background Color",
      "default": "#FEF3F3"
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Text Color",
      "default": "#9B3462"
    },
    {
      "type": "color",
      "id": "wave_color",
      "label": "Wave Color",
      "default": "#FDE8E6"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "limit": 7,
      "settings": [
        {
          "type": "text",
          "id": "product_name",
          "label": "Product Name",
          "default": "Vanilla"
        },
        {
          "type": "image_picker",
          "id": "product_icon",
          "label": "Product Icon (Navigation)",
          "info": "Small icon shown in circular navigation"
        },
        {
          "type": "image_picker",
          "id": "center_image",
          "label": "Center Product Image",
          "info": "Large image displayed in center"
        },
        {
          "type": "text",
          "id": "flavor_name",
          "label": "Flavor Name",
          "default": "vanilla",
          "info": "Displayed at bottom"
        }
      ]
    },
    {
      "type": "ingredient",
      "name": "Ingredient",
      "settings": [
        {
          "type": "text",
          "id": "parent_product",
          "label": "Parent Product ID",
          "info": "Copy the block ID from the product block above. Find it by clicking the product block and looking at the URL."
        },
        {
          "type": "image_picker",
          "id": "ingredient_image",
          "label": "Ingredient Image"
        },
        {
          "type": "text",
          "id": "ingredient_name",
          "label": "Ingredient Name",
          "default": "Crunchy Pretzels"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Ingredients Showcase"
    }
  ]
}
{% endschema %}
